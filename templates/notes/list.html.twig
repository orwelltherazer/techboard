{# templates/notes/list.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}TechBoard - Notes{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Notes</h2>
    <a href="notes.php?action=add" class="btn btn-primary">Nouvelle note</a>
</div>

{% if success %}
<div class="alert alert-success alert-dismissible fade show" role="alert" id="success-alert">
    {{ success }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<script>
    setTimeout(function() {
        var alert = document.getElementById('success-alert');
        if (alert) {
            alert.classList.remove('show');
            setTimeout(function() {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 150);
        }
    }, 3000);
</script>
{% endif %}

<div class="row mb-3">
    <div class="col-md-3">
        <input type="text" class="form-control" id="search-notes" placeholder="Rechercher...">
    </div>
</div>

<div class="row" id="notes-container">
    {% for note in notes %}
        {% set colors = [
            'bg-warning-subtle text-warning-emphasis',
            'bg-info-subtle text-info-emphasis', 
            'bg-success-subtle text-success-emphasis',
            'bg-danger-subtle text-danger-emphasis',
            'bg-primary-subtle text-primary-emphasis',
            'bg-secondary-subtle text-secondary-emphasis'
        ] %}
        {% set color = colors[loop.index0 % colors|length] %}
    <div class="col-md-6 col-lg-4 mb-3 note-item" data-title="{{ note.title|lower }}" data-content="{{ note.content|lower }}">
        <div class="card h-100 border-0 {{ color }}">
            <div class="card-body">
                <h5 class="card-title">{{ note.title }}</h5>
                <p class="card-text">{{ note.content|slice(0, 120) ~ (note.content|length > 120 ? '...' : '') }}</p>
                
                <div class="mt-3 small">
                    {% if note.category %}
                        <h6 class="badge fw-bold bg-danger text-light p-2 rounded-pill">{{ note.category }}</h6>
                    {% endif %}
                    {% if note.related_project_name %}
                        <div><strong>Projet :</strong> {{ note.related_project_name }}</div>
                    {% endif %}
                    {% if note.related_task_title %}
                        <div><strong>Tâche :</strong> {{ note.related_task_title }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer bg-transparent d-flex justify-content-between align-items-center">
                <small class="text-muted fs-7">
                    {{ note.created_at|date('d/m/Y') }}
                </small>
                <a href="notes.php?action=edit&id={{ note.id }}" class="btn btn-sm btn-outline-secondary border-0">
                    <i class="fas fa-edit"></i>
                </a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info">Aucune note trouvée.</div>
    </div>
    {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-notes');
    const noteItems = document.querySelectorAll('.note-item');
    
    function filterNotes() {
        const searchValue = searchInput.value.toLowerCase();
        
        noteItems.forEach(item => {
            const titleMatch = !searchValue || item.dataset.title.includes(searchValue);
            const contentMatch = !searchValue || item.dataset.content.includes(searchValue);
            
            item.style.display = (titleMatch || contentMatch) ? 'block' : 'none';
        });
    }
    
    searchInput.addEventListener('input', filterNotes);
});
</script>
{% endblock %}