{# templates/tasks/form.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}TechBoard - {{ is_edit ? 'Modifier' : 'Nouvelle' }} tâche{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">{{ is_edit ? 'Modifier la tâche' : 'Nouvelle tâche' }}</h2>
    <a href="tasks.php" class="btn btn-sm btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Retour
    </a>
</div>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

<div class="card border-0 shadow-sm" style="background-color: #fafafa;">
    <div class="card-body p-3">
        <form method="POST">
            <div class="row g-2">
                <div class="col-md-12">
                    <label for="title" class="form-label small fw-bold">Titre *</label>
                    <input type="text" class="form-control form-control-sm" id="title" name="title" value="{{ task.title ?? '' }}" required>
                </div>
                
                <div class="col-md-12">
                    <label for="description" class="form-label small fw-bold">Description</label>
                    <textarea class="form-control form-control-sm" id="description" name="description" rows="2">{{ task.description ?? '' }}</textarea>
                </div>
                
                <div class="col-md-6">
                    <label for="category" class="form-label small fw-bold">Catégorie</label>
                    <select class="form-select form-select-sm" id="category" name="category">
                        <option value="it" {% if (task.category ?? 'it') == 'it' %}selected{% endif %}>Informatique</option>
                        <option value="maintenance" {% if (task.category ?? '') == 'maintenance' %}selected{% endif %}>Maintenance</option>
                        <option value="communication" {% if (task.category ?? '') == 'communication' %}selected{% endif %}>Communication</option>
                        <option value="security" {% if (task.category ?? '') == 'security' %}selected{% endif %}>Sécurité</option>
                        <option value="network" {% if (task.category ?? '') == 'network' %}selected{% endif %}>Réseau</option>
                        <option value="other" {% if (task.category ?? '') == 'other' %}selected{% endif %}>Autre</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label for="status" class="form-label small fw-bold">Statut</label>
                    <select class="form-select form-select-sm" id="status" name="status">
                        <option value="not_started" {% if (task.status ?? 'not_started') == 'not_started' %}selected{% endif %}>A faire</option>
                        <option value="in_progress" {% if (task.status ?? '') == 'in_progress' %}selected{% endif %}>En cours</option>
                        <option value="completed" {% if (task.status ?? '') == 'completed' %}selected{% endif %}>Fait</option>
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label for="progress_percent" class="form-label small fw-bold">
                        Avancement <span class="text-muted small">(%)</span>
                    </label>
                    <input
                        type="range"
                        class="form-range mb-0"
                        id="progress_percent"
                        name="progress_percent"
                        min="0"
                        max="100"
                        value="{{ task.progress_percent ?? '0' }}"
                        oninput="document.getElementById('progress_percent_value').textContent = this.value + '%'"
                        style="accent-color: var(--bs-primary); cursor: pointer;"
                    >
                    <div class="text-end mt-1">
                        <span id="progress_percent_value" class="fw-semibold text-primary small">
                            {{ task.progress_percent ?? '0' }}%
                        </span>
                    </div>
                </div>

                <div class="col-md-6">
                    <label for="due_date" class="form-label small fw-bold">Échéance</label>
                    <input type="date" class="form-control form-control-sm" id="due_date" name="due_date" value="{{ task.due_date ?? '' }}">
                </div>
                
                <div class="col-md-6">
                    <label for="assignee_id" class="form-label small fw-bold">Assigné à</label>
                    <select class="form-select form-select-sm" id="assignee_id" name="assignee_id">
                        <option value="">Non assigné</option>
                        {% for contact in contacts %}
                        <option value="{{ contact.id }}" {% if contact.id == (task.assignee_id ?? null) %}selected{% endif %}>
                            {{ contact.name }}{% if contact.company %} ({{ contact.company }}){% endif %}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-6">
                    <label for="project_id" class="form-label small fw-bold">Projet associé</label>
                    <select class="form-select form-select-sm" id="project_id" name="project_id">
                        <option value="">Aucun projet</option>
                        {% for project in projects %}
                        <option value="{{ project.id }}" {% if project.id == (task.project_id ?? null) %}selected{% endif %}>
                            {{ project.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="mt-3 pt-2 border-top border-light text-end">
                <a href="tasks.php" class="btn btn-sm btn-outline-secondary">Annuler</a>
                <button type="submit" class="btn btn-success btn-sm px-3 ms-1">
                    <i class="fas fa-save"></i> Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}